# Документация по продукту для разработчиков

## Используемые инструменты для разработки проекта
1. Библиотека [**Crow**](https://crowcpp.org/master/) и ее реализация на [GitHub](https://github.com/CrowCpp/Crow). В библиотеке, по мимо, реализации **REST API** и **https**-сервера, также реализованы следующие инструментарии: 
   - Протокол **Web-sockets**
   - Логирование посредством вызова макросов **CROW_LOG_**<уровень>
   - Работа с **json** структурами
2. Библиотека **[Asio Boost](https://github.com/chriskohlhoff/asio)** и перевод [документации](https://github.com/ru-cpp-tutorials/asio-tutorial/tree/main) для нее.

## Структура проекта    

```
- packages/                 - содержит собранные пакеты под различные архитектуры
- locales/                  - содержат файлы переводов в формате json
- src/                      - все исходные файлы проекта
- src/hpp                   - заголовочные файлы проекта (собственные и заимствованные)
- src/libs                  - исходные файлы библиотек проекта (собственные и заимствованные)
- src/kvaspro.cpp           - исполняемый основной файл проекта
- src/tests                 - тесты для проекта на С++ (GTest)
- src/tests/hpp/            - заголовочные файлы 
- src/tests/libs/           - исходные файлы библиотек используемые в тестах
- src/tests/run_all_tests   - исполняемый файл по запуску всех тестов
- Makefile                  - файл манифеста для сборки пакета
- config.json               - файл конфигурации проекта
```

### Конфигурация пакета

1. Основным файлом кофигурации пакета является файл `config.json` 
2. 

## Описание основных модулей и инструментов 

### Тестирование

1. Тесты используют библиотеки **Google Test** и **Google Mock**, обе библиотеки подключены в файле манифеста.
2. Папка тестов находится внутри папки исходного кода: `src/tests/`.
3. Для запуска тестов используется основной файл `tests/run_all_tests.cpp`.
4. Принятое для тестов именование файлов выглядит так `test_название_процесса_тестирования`, как пример, файл тестирования функций локализации называется `test_localization.cpp`
5. После написания тестов в отдельном файле, его необходимо включить для работы в файле `tests/run_all_tests.cpp`, путем подключения его через механизм `#include`, например `#include "test_localization.cpp"`
6. Если потребуется включение каких либо библиотек и их заголовочных файлов, то для этих целей служат папки `tests/libs` и `tests/hpp`. В случае наличия в них файлов, необходимо включить эти папки или одну из них в файл манифеста `Makefile`, как показано ниже:
```c++
if [ "$(BUILD_TESTING)" = "1" ]; then \
    echo && echo "===> Компиляция тестов..."; \
    $(TARGET_CXX) \
    $(TARGET_CPPFLAGS) $(TARGET_CXXFLAGS) \
    -I$(PKG_BUILD_DIR)/hpp \
    -I$(GTEST_EXTRACTED_DIR)/googletest \
    -I$(GTEST_EXTRACTED_DIR)/googlemock/include \
    -I$(GTEST_EXTRACTED_DIR)/googletest/include \
    -I$(PKG_BUILD_DIR)/tests/hpp\
    $(PKG_BUILD_DIR)/tests/run_all_tests.cpp \
    $(PKG_BUILD_DIR)/libs/*.cpp \
    $(PKG_BUILD_DIR)/tests/libs/*.cpp\
    -o $(PKG_BUILD_DIR)/run_all_tests \
    $(TARGET_LDFLAGS) \
    $(GTEST_EXTRACTED_DIR)/build/lib/libgtest.a \
    $(GTEST_EXTRACTED_DIR)/build/lib/libgtest_main.a \
    $(GTEST_EXTRACTED_DIR)/build/lib/libgmock.a \
    -DUNIT_TEST; \
fi
```

### Логирование 
Макросы логирования следующие:
```
1. CROW_LOG_DEBUG       - отладка
2. LOG_DEBUG        - заметка
3. CROW_LOG_WARNING     - предупреждение
4. CROW_LOG_ERROR       - ошибка
5. CROW_LOG_CRITICAL    - критично
``` 

 > **Важно!**<br>
 `CROW_LOG_DEBUG` - данный макрос по какой то причине не выводит информацию в консоль на этом уровне логирования, поэтому рекомендуется установить уровень логирования в `Info` и использовать именно его для отладочных сообщений. 

Функция логирования была доработана (файлы `kvpLogger.*pp`) и теперь есть возможность задавать формат вывода в функции `getCurrentTimeFormatted` и задавать вывод в файл. 


### Поддержка мультиязычности

- Файлы поддержки мультиязычности `kvpLocalization.*pp` находятся в папках `hpp` и `libs` соответственно. 
- Поддержка реализована через механизм настраиваемого перевода текста, путем использования глобальной функции `_("текст для перевода")`. Данная функция ищет и папке `locales`, которая находится после установки пакета в папке самого пакета, файлы с кодом имени установленного ранее языка, который представляет из себя `json` файл, каждая строчка из которого содержит пару `{"текст на русском": "перевод на выбранный язык"}`, например для турецкого языка функция ищет файл `locale/tr.json`. 
- Основным языком для перевода является русский язык. 
- Если файл языка не найден или не найдена фраза для перевода, то функция возвращает русский вариант. 